{"version":3,"sources":["webpack://Computed/webpack/universalModuleDefinition","webpack://Computed/webpack/bootstrap","webpack://Computed/./src/computed.js","webpack://Computed/./src/dep.js","webpack://Computed/./src/observe.js","webpack://Computed/./src/util.js","webpack://Computed/./src/watcher.js"],"names":["util","initData","opts","isObject","data","prop","initComputed","ctx","cb","computed","_computedWatchers","watcher","Watcher","bind","undefined","createComputedGetter","val","get","Dep","target","depend","Object","defineProperty","enumerable","configurable","set","noop","Computed","props","keys","i","l","length","dirty","forceUpdate","pushStack","popStack","$$dep_count","subs","id","addDep","update","targetStack","o","push","pop","observe","obj","ob","hasOwn","__ob__","Observer","value","def","walk","defineReactive","k","hasOwnProperty","call","writable","key","dep","property","getOwnPropertyDescriptor","getter","setter","arguments","childOb","newVal","notify","$$watcher_count","callUpdateManually","a","b","deps","newDeps","err","cleanupDeps","force","oldValue","removeSub","addSub"],"mappings":"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","file":"wx-computed.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Computed\"] = factory();\n\telse\n\t\troot[\"Computed\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/computed.js\");\n","// @flow\n\nimport * as util from './util';\nimport observe from './observe';\nimport Watcher from './watcher';\nimport Dep from './dep';\n\nfunction initData(opts: any) {\n  if (util.isObject(opts) && util.isObject(opts.data)) {\n    for (const prop in opts.data) {\n      observe(opts.data);\n    }\n  }\n}\n\nfunction initComputed(ctx: Computed, opts: Object, cb?: Function) {\n  if (util.isObject(opts) && util.isObject(opts.computed)) {\n    for (let prop in opts.computed) {\n      if (!util.isObject(opts.data)) {\n        opts.data = {};\n      }\n      if (!ctx._computedWatchers) {\n        ctx._computedWatchers = {};\n      }\n\n      const watcher = (((ctx._computedWatchers: any): Object)[\n        prop\n      ] = new Watcher(\n        opts.computed[prop].bind(opts),\n        cb ? cb.bind(opts, prop) : undefined,\n        true\n      ));\n\n      function createComputedGetter() {\n        const val = watcher.get();\n        if (Dep.target) {\n          watcher.depend();\n        }\n        return val;\n      }\n\n      Object.defineProperty(opts.data, prop, {\n        enumerable: true,\n        configurable: true,\n        set: util.noop,\n        get: createComputedGetter\n      });\n    }\n  }\n}\n\nclass Computed {\n  static util = util;\n  _computedWatchers: { [k: string | number]: Watcher } | void;\n  constructor(opts: any, cb?: Function) {\n    initData(opts);\n    initComputed(this, opts, cb);\n  }\n  execDirtyWatcher() {\n    if (this._computedWatchers) {\n      const props = Object.keys(this._computedWatchers);\n      for (let i = 0, l = props.length; i < l; i++) {\n        const watcher = this._computedWatchers[props[i]];\n        if (watcher.dirty) {\n          watcher.forceUpdate();\n        }\n      }\n    }\n  }\n}\n\nexport default Computed;\n","// @flow\nimport type Watcher from './watcher';\n\nlet $$dep_count = 0;\n\nclass Dep {\n  static target: Watcher | void;\n  subs: { [k: string | number]: Watcher };\n  id: number;\n  constructor() {\n    this.subs = {};\n    this.id = $$dep_count++;\n  }\n  addSub(watcher: Watcher) {\n    if (!this.subs[watcher.id]) {\n      this.subs[watcher.id] = watcher;\n    }\n  }\n  removeSub(watcher: Watcher) {\n    if (this.subs[watcher.id]) {\n      delete this.subs[watcher.id];\n    }\n  }\n\n  depend() {\n    if (Dep.target) {\n      Dep.target.addDep(this);\n    }\n  }\n  notify() {\n    for (const prop in this.subs) {\n      this.subs[prop].update();\n    }\n  }\n}\n\nexport default Dep;\n\nconst targetStack: Array<any> = [];\n\nexport function pushStack(o: any) {\n  targetStack.push(o);\n  Dep.target = o;\n}\n\nexport function popStack() {\n  targetStack.pop();\n  Dep.target = targetStack[targetStack.length - 1];\n}\n","// @flow\nimport * as util from './util';\n\nfunction observe(obj: any): Observer | void {\n  if (!util.isObject(obj)) {\n    return;\n  }\n  let ob;\n  if (util.hasOwn(obj, '__ob__') && obj.__ob__ instanceof Observer) {\n    ob = obj.__ob__;\n  } else {\n    ob = new Observer(obj);\n  }\n  return ob;\n}\n\nclass Observer {\n  value: Object;\n  constructor(value: Object) {\n    this.value = value;\n    util.def(value, '__ob__', this);\n    this.walk(value);\n  }\n  walk(obj) {\n    const keys = Object.keys(obj);\n    for (let i = 0, l = keys.length; i < l; i++) {\n      util.defineReactive(obj, keys[i]);\n    }\n  }\n}\n\nexport default observe;\n","// @flow\n\nimport observe from './observe';\nimport Dep from './dep';\n\nexport function isObject(o: any): boolean {\n  return o && typeof o === 'object';\n}\n\nexport function hasOwn(o: Object, k: string | number) {\n  return Object.hasOwnProperty.call(o, k);\n}\n\nexport function def(\n  o: Object,\n  k: string | number,\n  value: any,\n  enumerable?: any\n) {\n  Object.defineProperty(o, k, {\n    configurable: true,\n    writable: true,\n    enumerable: !!enumerable,\n    value\n  });\n}\n\nexport function noop() {}\n\nexport function defineReactive(obj: Object, key: string | number, val?: any) {\n  const dep = new Dep();\n  const property = Object.getOwnPropertyDescriptor(obj, key);\n  if (property && property.configurable === false) {\n    return;\n  }\n  const getter = property && property.get;\n  const setter = property && property.set;\n\n  if ((!getter || setter) && arguments.length === 2) {\n    val = obj[key];\n  }\n\n  let childOb = observe(val);\n  Object.defineProperty(obj, key, {\n    get() {\n      const value = getter ? getter.call(obj) : val;\n\n      /**\n       * TODO\n       * 收集依赖\n       */\n\n      if (Dep.target) {\n        dep.depend();\n      }\n\n      return value;\n    },\n    set(newVal: any) {\n      const value = getter ? getter.call(obj) : val;\n      if (newVal === value) {\n        return;\n      }\n      if (getter && !setter) {\n        return;\n      } else if (setter) {\n        setter.call(obj, newVal);\n      } else {\n        val = newVal;\n      }\n      childOb = observe(newVal);\n      /**\n       * TODO\n       * 触发watcher\n       */\n      dep.notify();\n    }\n  });\n}\n","// @flow\n\nimport type Dep from './dep';\nimport { pushStack, popStack } from './dep';\nimport * as util from './util';\n\nlet $$watcher_count = 0;\n\nclass Watcher {\n  getter: () => any;\n  cb: ((a?: any, b?: any) => void) | void;\n  deps: { [k: string | number]: Dep };\n  newDeps: { [k: string | number]: Dep };\n  value: any;\n  id: number;\n  callUpdateManually: boolean | void;\n  dirty: boolean = false;\n  constructor(\n    getter: Function,\n    cb?: (a?: any, b?: any) => any,\n    callUpdateManually?: boolean\n  ) {\n    this.getter = getter;\n    this.cb = (a, b) => {\n      if (cb) {\n        cb(a, b);\n      }\n      this.dirty = false;\n    };\n    this.deps = {};\n    this.newDeps = {};\n    this.id = $$watcher_count++;\n    this.callUpdateManually = callUpdateManually;\n    this.value = this.get();\n  }\n  get() {\n    pushStack(this);\n    let val;\n    try {\n      val = this.getter();\n    } catch (err) {\n      throw err;\n    } finally {\n      popStack();\n      this.cleanupDeps();\n    }\n    return val;\n  }\n  update(force?: boolean) {\n    const value = this.get();\n    const oldValue = this.value;\n    if (force === true || value !== this.value || util.isObject(value)) {\n      this.dirty = true;\n      if (\n        (force === true || (!this.callUpdateManually && force !== false)) &&\n        this.cb\n      ) {\n        this.cb(value, oldValue);\n      }\n      this.value = value;\n    }\n  }\n  forceUpdate() {\n    this.update(true);\n  }\n  cleanupDeps() {\n    for (const id in this.deps) {\n      if (!this.newDeps[id]) {\n        this.deps[id].removeSub(this);\n      }\n    }\n    this.deps = this.newDeps;\n    this.newDeps = {};\n  }\n  addDep(dep: Dep) {\n    if (!this.newDeps[dep.id]) {\n      this.newDeps[dep.id] = dep;\n      if (!this.deps[dep.id]) {\n        dep.addSub(this);\n      }\n    }\n  }\n  depend() {\n    for (const prop in this.deps) {\n      this.deps[prop].depend();\n    }\n  }\n}\n\nexport default Watcher;\n"],"sourceRoot":""}