{"version":3,"sources":["webpack://Computed/webpack/universalModuleDefinition","webpack://Computed/webpack/bootstrap","webpack://Computed/./lib/index.js","webpack://Computed/./src/computed.js","webpack://Computed/./src/dep.js","webpack://Computed/./src/observe.js","webpack://Computed/./src/util.js","webpack://Computed/./src/watcher.js"],"names":["util","initData","self","opts","isObject","data","_data","proxy","obj","prop","Object","defineProperty","configurable","enumerable","get","set","newVal","initComputed","ctx","cb","computed","_computedWatchers","watcher","Watcher","bind","undefined","createComputedGetter","dirty","evaluate","Dep","target","depend","value","noop","Computed","force","assign","pushStack","popStack","$$dep_count","subs","id","addDep","update","targetStack","o","push","pop","length","observe","ob","hasOwn","__ob__","Observer","def","walk","keys","i","l","defineReactive","k","hasOwnProperty","call","writable","key","val","dep","property","getOwnPropertyDescriptor","getter","setter","arguments","childOb","notify","$$watcher_count","callUpdateManually","deps","newDeps","err","cleanupDeps","oldValue","removeSub","addSub"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,kDAA0C,gCAAgC;AAC1E;AACA;;AAEA;AACA;AACA;AACA,gEAAwD,kBAAkB;AAC1E;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAyC,iCAAiC;AAC1E,wHAAgH,mBAAmB,EAAE;AACrI;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;;AAGA;AACA;;;;;;;;;;;;AClFA,iBAAiB,mBAAO,CAAC,0CAAiB;;AAE1C;;AAEA;;AAEA;;;;;;;;;;;;;;;;;;;;;ACJA;;IAAYA,I;;AACZ;;;;AACA;;;;AACA;;;;;;;;;;;;AAEA,SAASC,QAAT,CAAkBC,IAAlB,EAAkCC,IAAlC,EAA6C;AAC3C,MAAIH,KAAKI,QAAL,CAAcD,IAAd,KAAuBH,KAAKI,QAAL,CAAcD,KAAKE,IAAnB,CAA3B,EAAqD;AACnD,QAAIA,OAAQH,KAAKI,KAAL,GAAaH,KAAKE,IAA9B;AACA,2BAAQA,IAAR;AACAE,UAAML,IAAN,EAAYG,IAAZ;AACD;AACF;;AAED,SAASE,KAAT,CAAeL,IAAf,EAA+BM,GAA/B,EAA4C;AAAA,6BAC/BC,KAD+B;AAExCC,WAAOC,cAAP,CAAsBT,IAAtB,EAA4BO,KAA5B,EAAkC;AAChCG,oBAAc,IADkB;AAEhCC,kBAAY,IAFoB;AAGhCC,SAHgC,iBAG1B;AACJ,eAAON,IAAIC,KAAJ,CAAP;AACD,OAL+B;AAMhCM,SANgC,eAM5BC,MAN4B,EAMf;AACfR,YAAIC,KAAJ,IAAYO,MAAZ;AACD;AAR+B,KAAlC;AAFwC;;AAC1C,OAAK,IAAMP,KAAX,IAAmBD,GAAnB,EAAwB;AAAA,UAAbC,KAAa;AAWvB;AACF;;AAED,SAASQ,YAAT,CACEC,GADF,EAEEf,IAFF,EAGEgB,EAHF,EAIE;AACA,MAAInB,KAAKI,QAAL,CAAcD,IAAd,KAAuBH,KAAKI,QAAL,CAAcD,KAAKiB,QAAnB,CAA3B,EAAyD;AAAA,iCAC9CX,MAD8C;AAErD,UAAI,CAACS,IAAIG,iBAAT,EAA4B;AAC1BH,YAAIG,iBAAJ,GAAwB,EAAxB;AACD;;AAED,UAAMC,UAAaJ,IAAIG,iBAAN,CACfZ,MADe,IAEb,IAAIc,iBAAJ,CACFpB,KAAKiB,QAAL,CAAcX,MAAd,EAAoBe,IAApB,CAAyBN,GAAzB,CADE,EAEFC,KAAKA,GAAGK,IAAH,CAAQN,GAAR,EAAaT,MAAb,CAAL,GAA0BgB,SAFxB,EAGF,IAHE,CAFJ;;AAQA,eAASC,oBAAT,GAAgC;AAC9B,YAAIJ,QAAQK,KAAZ,EAAmB;AACjBL,kBAAQM,QAAR;AACD;AACD,YAAIC,cAAIC,MAAR,EAAgB;AACdR,kBAAQS,MAAR;AACD;AACD,eAAOT,QAAQU,KAAf;AACD;;AAEDtB,aAAOC,cAAP,CAAsBO,GAAtB,EAA2BT,MAA3B,EAAiC;AAC/BI,oBAAY,IADmB;AAE/BD,sBAAc,IAFiB;AAG/BG,aAAKf,KAAKiC,IAHqB;AAI/BnB,aAAKY;AAJ0B,OAAjC;AAxBqD;;AACvD,SAAK,IAAIjB,MAAT,IAAiBN,KAAKiB,QAAtB,EAAgC;AAAA,aAAvBX,MAAuB;AA6B/B;AACF;AACF;;IAEKyB,Q;AAIJ,oBAAY/B,IAAZ,EAAuBgB,EAAvB,EAAsC;AAAA;;AACpClB,aAAS,IAAT,EAAeE,IAAf;AACAc,iBAAa,IAAb,EAAmBd,IAAnB,EAAyBgB,EAAzB;AACD;;;;gCACWgB,K,EAAiB;AAC3B,UAAI3B,MAAM,EAAV;AACA,WAAK,IAAMC,MAAX,IAAmB,KAAKY,iBAAxB,EAA2C;AACzC,YAAMC,WAAU,KAAKD,iBAAL,CAAuBZ,MAAvB,CAAhB;AACA,YAAI0B,SAASb,SAAQK,KAArB,EAA4B;AAC1BL,mBAAQM,QAAR;AACA,cAAMI,QAAQV,SAAQU,KAAtB;AACAtB,iBAAO0B,MAAP,CAAc5B,GAAd,sBACGC,MADH,EACUuB,KADV;AAGD;AACF;AACD,aAAOxB,GAAP;AACD;;;;;;AArBG0B,Q,CACGlC,I,GAAOA,I;kBAuBDkC,Q;;;;;;;;;;;;;;;;;;;;QCrDCG,S,GAAAA,S;QAKAC,Q,GAAAA,Q;;;;AA1ChB,IAAIC,cAAc,CAAlB;;IAEMV,G;AAIJ,iBAAc;AAAA;;AACZ,SAAKW,IAAL,GAAY,EAAZ;AACA,SAAKC,EAAL,GAAUF,aAAV;AACD;;;;2BACMjB,O,EAAkB;AACvB,UAAI,CAAC,KAAKkB,IAAL,CAAUlB,QAAQmB,EAAlB,CAAL,EAA4B;AAC1B,aAAKD,IAAL,CAAUlB,QAAQmB,EAAlB,IAAwBnB,OAAxB;AACD;AACF;;;8BACSA,O,EAAkB;AAC1B,UAAI,KAAKkB,IAAL,CAAUlB,QAAQmB,EAAlB,CAAJ,EAA2B;AACzB,eAAO,KAAKD,IAAL,CAAUlB,QAAQmB,EAAlB,CAAP;AACD;AACF;;;6BAEQ;AACP,UAAIZ,IAAIC,MAAR,EAAgB;AACdD,YAAIC,MAAJ,CAAWY,MAAX,CAAkB,IAAlB;AACD;AACF;;;6BACQ;AACP,WAAK,IAAMjC,IAAX,IAAmB,KAAK+B,IAAxB,EAA8B;AAC5B,aAAKA,IAAL,CAAU/B,IAAV,EAAgBkC,MAAhB;AACD;AACF;;;;;;kBAGYd,G;;;AAEf,IAAMe,cAA0B,EAAhC;;AAEO,SAASP,SAAT,CAAmBQ,CAAnB,EAA2B;AAChCD,cAAYE,IAAZ,CAAiBD,CAAjB;AACAhB,MAAIC,MAAJ,GAAae,CAAb;AACD;;AAEM,SAASP,QAAT,GAAoB;AACzBM,cAAYG,GAAZ;AACAlB,MAAIC,MAAJ,GAAac,YAAYA,YAAYI,MAAZ,GAAqB,CAAjC,CAAb;AACD,C;;;;;;;;;;;;;;;;;;;;AC/CD;;IAAYhD,I;;;;;;AAEZ,SAASiD,OAAT,CAAiBzC,GAAjB,EAA4C;AAC1C,MAAI,CAACR,KAAKI,QAAL,CAAcI,GAAd,CAAL,EAAyB;AACvB;AACD;AACD,MAAI0C,WAAJ;AACA,MAAIlD,KAAKmD,MAAL,CAAY3C,GAAZ,EAAiB,QAAjB,KAA8BA,IAAI4C,MAAJ,YAAsBC,QAAxD,EAAkE;AAChEH,SAAK1C,IAAI4C,MAAT;AACD,GAFD,MAEO;AACLF,SAAK,IAAIG,QAAJ,CAAa7C,GAAb,CAAL;AACD;AACD,SAAO0C,EAAP;AACD;;IAEKG,Q;AAEJ,oBAAYrB,KAAZ,EAA2B;AAAA;;AACzB,SAAKA,KAAL,GAAaA,KAAb;AACAhC,SAAKsD,GAAL,CAAStB,KAAT,EAAgB,QAAhB,EAA0B,IAA1B;AACA,SAAKuB,IAAL,CAAUvB,KAAV;AACD;;;;yBACIxB,G,EAAK;AACR,UAAMgD,OAAO9C,OAAO8C,IAAP,CAAYhD,GAAZ,CAAb;AACA,WAAK,IAAIiD,IAAI,CAAR,EAAWC,IAAIF,KAAKR,MAAzB,EAAiCS,IAAIC,CAArC,EAAwCD,GAAxC,EAA6C;AAC3CzD,aAAK2D,cAAL,CAAoBnD,GAApB,EAAyBgD,KAAKC,CAAL,CAAzB;AACD;AACF;;;;;;kBAGYR,O;;;;;;;;;;;;;;;;;;;;QC1BC7C,Q,GAAAA,Q;QAIA+C,M,GAAAA,M;QAIAG,G,GAAAA,G;QAcArB,I,GAAAA,I;QAEA0B,c,GAAAA,c;;AA3BhB;;;;AACA;;;;;;AAEO,SAASvD,QAAT,CAAkByC,CAAlB,EAAmC;AACxC,SAAOA,KAAK,QAAOA,CAAP,yCAAOA,CAAP,OAAa,QAAzB;AACD;;AAEM,SAASM,MAAT,CAAgBN,CAAhB,EAA2Be,CAA3B,EAA+C;AACpD,SAAOlD,OAAOmD,cAAP,CAAsBC,IAAtB,CAA2BjB,CAA3B,EAA8Be,CAA9B,CAAP;AACD;;AAEM,SAASN,GAAT,CACLT,CADK,EAELe,CAFK,EAGL5B,KAHK,EAILnB,UAJK,EAKL;AACAH,SAAOC,cAAP,CAAsBkC,CAAtB,EAAyBe,CAAzB,EAA4B;AAC1BhD,kBAAc,IADY;AAE1BmD,cAAU,IAFgB;AAG1BlD,gBAAY,CAAC,CAACA,UAHY;AAI1BmB;AAJ0B,GAA5B;AAMD;;AAEM,SAASC,IAAT,GAAgB,CAAE;;AAElB,SAAS0B,cAAT,CAAwBnD,GAAxB,EAAqCwD,GAArC,EAA2DC,GAA3D,EAAsE;AAC3E,MAAMC,MAAM,IAAIrC,aAAJ,EAAZ;AACA,MAAMsC,WAAWzD,OAAO0D,wBAAP,CAAgC5D,GAAhC,EAAqCwD,GAArC,CAAjB;AACA,MAAIG,YAAYA,SAASvD,YAAT,KAA0B,KAA1C,EAAiD;AAC/C;AACD;AACD,MAAMyD,SAASF,YAAYA,SAASrD,GAApC;AACA,MAAMwD,SAASH,YAAYA,SAASpD,GAApC;;AAEA,MAAI,CAAC,CAACsD,MAAD,IAAWC,MAAZ,KAAuBC,UAAUvB,MAAV,KAAqB,CAAhD,EAAmD;AACjDiB,UAAMzD,IAAIwD,GAAJ,CAAN;AACD;;AAED,MAAIQ,UAAU,uBAAQP,GAAR,CAAd;AACAvD,SAAOC,cAAP,CAAsBH,GAAtB,EAA2BwD,GAA3B,EAAgC;AAC9BlD,OAD8B,iBACxB;AACJ,UAAMkB,QAAQqC,SAASA,OAAOP,IAAP,CAAYtD,GAAZ,CAAT,GAA4ByD,GAA1C;;AAEA;;;;;AAKA,UAAIpC,cAAIC,MAAR,EAAgB;AACdoC,YAAInC,MAAJ;AACD;;AAED,aAAOC,KAAP;AACD,KAd6B;AAe9BjB,OAf8B,eAe1BC,MAf0B,EAeb;AACf,UAAMgB,QAAQqC,SAASA,OAAOP,IAAP,CAAYtD,GAAZ,CAAT,GAA4ByD,GAA1C;AACA,UAAIjD,WAAWgB,KAAf,EAAsB;AACpB;AACD;AACD,UAAIqC,UAAU,CAACC,MAAf,EAAuB;AACrB;AACD,OAFD,MAEO,IAAIA,MAAJ,EAAY;AACjBA,eAAOR,IAAP,CAAYtD,GAAZ,EAAiBQ,MAAjB;AACD,OAFM,MAEA;AACLiD,cAAMjD,MAAN;AACD;AACDwD,gBAAU,uBAAQxD,MAAR,CAAV;AACA;;;;AAIAkD,UAAIO,MAAJ;AACD;AAjC6B,GAAhC;AAmCD,C;;;;;;;;;;;;;;;;;;;;AC3ED;;AACA;;IAAYzE,I;;;;;;AAEZ,IAAI0E,kBAAkB,CAAtB;;IAEMnD,O;AASJ,mBACE8C,MADF,EAEElD,EAFF,EAGEwD,kBAHF,EAIE;AAAA;;AACA,SAAKN,MAAL,GAAcA,MAAd;AACA,SAAKlD,EAAL,GAAUA,EAAV;AACA,SAAKyD,IAAL,GAAY,EAAZ;AACA,SAAKC,OAAL,GAAe,EAAf;AACA,SAAKpC,EAAL,GAAUiC,iBAAV;AACA,SAAKC,kBAAL,GAA0BA,kBAA1B;AACA,SAAKhD,KAAL,GAAa,CAAC,CAACgD,kBAAf;AACA,SAAK3C,KAAL,GAAa2C,qBAAqBlD,SAArB,GAAiC,KAAKX,GAAL,EAA9C;AACD;;;;0BACK;AACJ,0BAAU,IAAV;AACA,UAAImD,YAAJ;AACA,UAAI;AACFA,cAAM,KAAKI,MAAL,EAAN;AACD,OAFD,CAEE,OAAOS,GAAP,EAAY;AACZ,cAAMA,GAAN;AACD,OAJD,SAIU;AACR;AACA,aAAKC,WAAL;AACD;AACD,aAAOd,GAAP;AACD;;;2BACM9B,K,EAAiB;AACtB,UAAI,KAAKwC,kBAAT,EAA6B;AAC3B,aAAKhD,KAAL,GAAa,IAAb;AACA;AACD;AACD,UAAMK,QAAQ,KAAKlB,GAAL,EAAd;AACA,UAAMkE,WAAW,KAAKhD,KAAtB;AACA,UAAIG,UAAU,IAAV,IAAkBH,UAAU,KAAKA,KAAjC,IAA0ChC,KAAKI,QAAL,CAAc4B,KAAd,CAA9C,EAAoE;AAClE,YAAIG,UAAU,KAAV,IAAmB,KAAKhB,EAA5B,EAAgC;AAC9B,eAAKA,EAAL,CAAQa,KAAR,EAAegD,QAAf;AACD;AACD,aAAKhD,KAAL,GAAaA,KAAb;AACD;AACF;;;+BACU;AACT,WAAKA,KAAL,GAAa,KAAKlB,GAAL,EAAb;AACA,WAAKa,KAAL,GAAa,KAAb;AACD;;;kCACa;AACZ,WAAKgB,MAAL,CAAY,IAAZ;AACD;;;kCACa;AACZ,WAAK,IAAMF,EAAX,IAAiB,KAAKmC,IAAtB,EAA4B;AAC1B,YAAI,CAAC,KAAKC,OAAL,CAAapC,EAAb,CAAL,EAAuB;AACrB,eAAKmC,IAAL,CAAUnC,EAAV,EAAcwC,SAAd,CAAwB,IAAxB;AACD;AACF;AACD,WAAKL,IAAL,GAAY,KAAKC,OAAjB;AACA,WAAKA,OAAL,GAAe,EAAf;AACD;;;2BACMX,G,EAAU;AACf,UAAI,CAAC,KAAKW,OAAL,CAAaX,IAAIzB,EAAjB,CAAL,EAA2B;AACzB,aAAKoC,OAAL,CAAaX,IAAIzB,EAAjB,IAAuByB,GAAvB;AACA,YAAI,CAAC,KAAKU,IAAL,CAAUV,IAAIzB,EAAd,CAAL,EAAwB;AACtByB,cAAIgB,MAAJ,CAAW,IAAX;AACD;AACF;AACF;;;6BACQ;AACP,WAAK,IAAMzE,IAAX,IAAmB,KAAKmE,IAAxB,EAA8B;AAC5B,aAAKA,IAAL,CAAUnE,IAAV,EAAgBsB,MAAhB;AACD;AACF;;;;;;kBAGYR,O","file":"computed.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Computed\"] = factory();\n\telse\n\t\troot[\"Computed\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./lib/index.js\");\n","const Computed = require('../src/computed');\n\nmodule.exports = Computed.default;\n\nexports = module.exports;\n\nexports.default = module.exports;\n","// @flow\n\nimport * as util from './util';\nimport observe from './observe';\nimport Watcher from './watcher';\nimport Dep from './dep';\n\nfunction initData(self: Computed, opts: any) {\n  if (util.isObject(opts) && util.isObject(opts.data)) {\n    var data = (self._data = opts.data);\n    observe(data);\n    proxy(self, data);\n  }\n}\n\nfunction proxy(self: Computed, obj: Object) {\n  for (const prop in obj) {\n    Object.defineProperty(self, prop, {\n      configurable: true,\n      enumerable: true,\n      get() {\n        return obj[prop];\n      },\n      set(newVal: any) {\n        obj[prop] = newVal;\n      }\n    });\n  }\n}\n\nfunction initComputed(\n  ctx: Computed,\n  opts: Object,\n  cb?: (prop?: string, newVal?: any, oldVal?: any) => any\n) {\n  if (util.isObject(opts) && util.isObject(opts.computed)) {\n    for (let prop in opts.computed) {\n      if (!ctx._computedWatchers) {\n        ctx._computedWatchers = {};\n      }\n\n      const watcher = (((ctx._computedWatchers: any): Object)[\n        prop\n      ] = new Watcher(\n        opts.computed[prop].bind(ctx),\n        cb ? cb.bind(ctx, prop) : undefined,\n        true\n      ));\n\n      function createComputedGetter() {\n        if (watcher.dirty) {\n          watcher.evaluate();\n        }\n        if (Dep.target) {\n          watcher.depend();\n        }\n        return watcher.value;\n      }\n\n      Object.defineProperty(ctx, prop, {\n        enumerable: true,\n        configurable: true,\n        set: util.noop,\n        get: createComputedGetter\n      });\n    }\n  }\n}\n\nclass Computed {\n  static util = util;\n  _computedWatchers: { [k: string | number]: Watcher } | void;\n  _data: { [k: string | number]: any } | void;\n  constructor(opts: any, cb?: Function) {\n    initData(this, opts);\n    initComputed(this, opts, cb);\n  }\n  getComputed(force?: boolean) {\n    var obj = {};\n    for (const prop in this._computedWatchers) {\n      const watcher = this._computedWatchers[prop];\n      if (force || watcher.dirty) {\n        watcher.evaluate();\n        const value = watcher.value;\n        Object.assign(obj, {\n          [prop]: value\n        });\n      }\n    }\n    return obj;\n  }\n}\n\nexport default Computed;\n","// @flow\nimport type Watcher from './watcher';\n\nlet $$dep_count = 0;\n\nclass Dep {\n  static target: Watcher | void;\n  subs: { [k: string | number]: Watcher };\n  id: number;\n  constructor() {\n    this.subs = {};\n    this.id = $$dep_count++;\n  }\n  addSub(watcher: Watcher) {\n    if (!this.subs[watcher.id]) {\n      this.subs[watcher.id] = watcher;\n    }\n  }\n  removeSub(watcher: Watcher) {\n    if (this.subs[watcher.id]) {\n      delete this.subs[watcher.id];\n    }\n  }\n\n  depend() {\n    if (Dep.target) {\n      Dep.target.addDep(this);\n    }\n  }\n  notify() {\n    for (const prop in this.subs) {\n      this.subs[prop].update();\n    }\n  }\n}\n\nexport default Dep;\n\nconst targetStack: Array<any> = [];\n\nexport function pushStack(o: any) {\n  targetStack.push(o);\n  Dep.target = o;\n}\n\nexport function popStack() {\n  targetStack.pop();\n  Dep.target = targetStack[targetStack.length - 1];\n}\n","// @flow\nimport * as util from './util';\n\nfunction observe(obj: any): Observer | void {\n  if (!util.isObject(obj)) {\n    return;\n  }\n  let ob;\n  if (util.hasOwn(obj, '__ob__') && obj.__ob__ instanceof Observer) {\n    ob = obj.__ob__;\n  } else {\n    ob = new Observer(obj);\n  }\n  return ob;\n}\n\nclass Observer {\n  value: Object;\n  constructor(value: Object) {\n    this.value = value;\n    util.def(value, '__ob__', this);\n    this.walk(value);\n  }\n  walk(obj) {\n    const keys = Object.keys(obj);\n    for (let i = 0, l = keys.length; i < l; i++) {\n      util.defineReactive(obj, keys[i]);\n    }\n  }\n}\n\nexport default observe;\n","// @flow\n\nimport observe from './observe';\nimport Dep from './dep';\n\nexport function isObject(o: any): boolean {\n  return o && typeof o === 'object';\n}\n\nexport function hasOwn(o: Object, k: string | number) {\n  return Object.hasOwnProperty.call(o, k);\n}\n\nexport function def(\n  o: Object,\n  k: string | number,\n  value: any,\n  enumerable?: any\n) {\n  Object.defineProperty(o, k, {\n    configurable: true,\n    writable: true,\n    enumerable: !!enumerable,\n    value\n  });\n}\n\nexport function noop() {}\n\nexport function defineReactive(obj: Object, key: string | number, val?: any) {\n  const dep = new Dep();\n  const property = Object.getOwnPropertyDescriptor(obj, key);\n  if (property && property.configurable === false) {\n    return;\n  }\n  const getter = property && property.get;\n  const setter = property && property.set;\n\n  if ((!getter || setter) && arguments.length === 2) {\n    val = obj[key];\n  }\n\n  let childOb = observe(val);\n  Object.defineProperty(obj, key, {\n    get() {\n      const value = getter ? getter.call(obj) : val;\n\n      /**\n       * TODO\n       * 收集依赖\n       */\n\n      if (Dep.target) {\n        dep.depend();\n      }\n\n      return value;\n    },\n    set(newVal: any) {\n      const value = getter ? getter.call(obj) : val;\n      if (newVal === value) {\n        return;\n      }\n      if (getter && !setter) {\n        return;\n      } else if (setter) {\n        setter.call(obj, newVal);\n      } else {\n        val = newVal;\n      }\n      childOb = observe(newVal);\n      /**\n       * TODO\n       * 触发watcher\n       */\n      dep.notify();\n    }\n  });\n}\n","// @flow\n\nimport type Dep from './dep';\nimport { pushStack, popStack } from './dep';\nimport * as util from './util';\n\nlet $$watcher_count = 0;\n\nclass Watcher {\n  getter: () => any;\n  cb: ((a?: any, b?: any) => void) | void;\n  deps: { [k: string | number]: Dep };\n  newDeps: { [k: string | number]: Dep };\n  value: any;\n  id: number;\n  callUpdateManually: boolean | void;\n  dirty: boolean;\n  constructor(\n    getter: Function,\n    cb?: (a?: any, b?: any) => any,\n    callUpdateManually?: boolean\n  ) {\n    this.getter = getter;\n    this.cb = cb;\n    this.deps = {};\n    this.newDeps = {};\n    this.id = $$watcher_count++;\n    this.callUpdateManually = callUpdateManually;\n    this.dirty = !!callUpdateManually;\n    this.value = callUpdateManually ? undefined : this.get();\n  }\n  get() {\n    pushStack(this);\n    let val;\n    try {\n      val = this.getter();\n    } catch (err) {\n      throw err;\n    } finally {\n      popStack();\n      this.cleanupDeps();\n    }\n    return val;\n  }\n  update(force?: boolean) {\n    if (this.callUpdateManually) {\n      this.dirty = true;\n      return;\n    }\n    const value = this.get();\n    const oldValue = this.value;\n    if (force === true || value !== this.value || util.isObject(value)) {\n      if (force !== false && this.cb) {\n        this.cb(value, oldValue);\n      }\n      this.value = value;\n    }\n  }\n  evaluate() {\n    this.value = this.get();\n    this.dirty = false;\n  }\n  forceUpdate() {\n    this.update(true);\n  }\n  cleanupDeps() {\n    for (const id in this.deps) {\n      if (!this.newDeps[id]) {\n        this.deps[id].removeSub(this);\n      }\n    }\n    this.deps = this.newDeps;\n    this.newDeps = {};\n  }\n  addDep(dep: Dep) {\n    if (!this.newDeps[dep.id]) {\n      this.newDeps[dep.id] = dep;\n      if (!this.deps[dep.id]) {\n        dep.addSub(this);\n      }\n    }\n  }\n  depend() {\n    for (const prop in this.deps) {\n      this.deps[prop].depend();\n    }\n  }\n}\n\nexport default Watcher;\n"],"sourceRoot":""}